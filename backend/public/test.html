<!DOCTYPE html>
<html>

<head>
    <title>Travel Online - API Test</title>
    <meta charset="UTF-8">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .api-status {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            background: #4CAF50;
            color: white;
            border-radius: 20px;
            font-weight: bold;
        }

        .endpoints {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .endpoint-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }

        .method {
            display: inline-block;
            padding: 5px 12px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            margin-right: 10px;
            font-family: monospace;
        }

        .endpoint {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .test-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:active {
            transform: translateY(0);
        }

        .result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            margin-top: 20px;
            overflow-x: auto;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }

        .success {
            color: #4CAF50;
        }

        .error {
            color: #f44336;
        }

        .response-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üåç Travel Online API</h1>
            <p class="subtitle">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST API –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π</p>
        </header>

        <div class="api-status">
            <p><span class="status-badge">API –¥–æ—Å—Ç—É–ø–Ω–æ</span> –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ <strong>http://localhost:3000</strong>
            </p>
            <p>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: <span id="current-time"></span></p>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('endpoints')">üìã –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã</div>
            <div class="tab" onclick="showTab('auth')">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</div>
            <div class="tab" onclick="showTab('travels')">üó∫Ô∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</div>
            <div class="tab" onclick="showTab('feed')">üåç –õ–µ–Ω—Ç–∞</div>
        </div>

        <div id="endpoints" class="tab-content active">
            <div class="endpoints">
                <div class="endpoint-card">
                    <h3><span class="method">GET</span> /api/health</h3>
                    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ API</p>
                    <button onclick="testEndpoint('/health', 'GET')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <div id="result-health" class="result"></div>
                </div>

                <div class="endpoint-card">
                    <h3><span class="method">POST</span> /api/auth/register</h3>
                    <p>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
                    <div class="endpoint">Content-Type: application/json</div>
                </div>

                <div class="endpoint-card">
                    <h3><span class="method">POST</span> /api/auth/login</h3>
                    <p>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
                    <div class="endpoint">Content-Type: application/json</div>
                </div>

                <div class="endpoint-card">
                    <h3><span class="method">GET</span> /api/feed</h3>
                    <p>–õ–µ–Ω—Ç–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π</p>
                    <div class="endpoint">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: ?country=...&page=...&limit=...</div>
                </div>

                <div class="endpoint-card">
                    <h3><span class="method">POST</span> /api/travels</h3>
                    <p>–°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</p>
                    <div class="endpoint">–¢—Ä–µ–±—É–µ—Ç—Å—è: Authorization: Bearer {token}</div>
                </div>

                <div class="endpoint-card">
                    <h3><span class="method">GET</span> /api/travels/my</h3>
                    <p>–ú–æ–∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</p>
                    <div class="endpoint">–¢—Ä–µ–±—É–µ—Ç—Å—è: Authorization: Bearer {token}</div>
                </div>
            </div>
        </div>

        <div id="auth" class="tab-content">
            <div class="test-section">
                <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                <div class="form-group">
                    <label for="reg-login">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="reg-login" placeholder="test_user">
                </div>
                <div class="form-group">
                    <label for="reg-email">Email:</label>
                    <input type="email" id="reg-email" placeholder="test@example.com">
                </div>
                <div class="form-group">
                    <label for="reg-password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="reg-password" placeholder="password123">
                </div>
                <div class="form-group">
                    <label for="reg-name">–ò–º—è:</label>
                    <input type="text" id="reg-name" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤">
                </div>
                <div class="form-group">
                    <label for="reg-country">–°—Ç—Ä–∞–Ω–∞:</label>
                    <input type="text" id="reg-country" placeholder="–†–æ—Å—Å–∏—è">
                </div>
                <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <div id="result-register" class="result"></div>
            </div>

            <div class="test-section">
                <h2>–í—Ö–æ–¥</h2>
                <div class="form-group">
                    <label for="login-login">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="login-login" placeholder="test_user">
                </div>
                <div class="form-group">
                    <label for="login-password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="login-password" placeholder="password123">
                </div>
                <button onclick="login()">–í–æ–π—Ç–∏</button>
                <div id="result-login" class="result"></div>
            </div>
        </div>

        <div id="travels" class="tab-content">
            <div class="test-section">
                <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</h2>
                <p><em>–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</em></p>
                <div class="form-group">
                    <label for="travel-title">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="travel-title" placeholder="–ú–æ—ë —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ">
                </div>
                <div class="form-group">
                    <label for="travel-description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="travel-description" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è..."></textarea>
                </div>
                <div class="form-group">
                    <label for="travel-country">–°—Ç—Ä–∞–Ω–∞:</label>
                    <input type="text" id="travel-country" placeholder="–§—Ä–∞–Ω—Ü–∏—è">
                </div>
                <div class="form-group">
                    <label for="travel-type">–¢–∏–ø:</label>
                    <select id="travel-type">
                        <option value="planned">–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ</option>
                        <option value="completed">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–µ</option>
                    </select>
                </div>
                <button onclick="createTravel()">–°–æ–∑–¥–∞—Ç—å –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</button>
                <div id="result-travel-create" class="result"></div>
            </div>

            <div class="test-section">
                <h2>–ú–æ–∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</h2>
                <p><em>–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</em></p>
                <button onclick="getMyTravels()">–ü–æ–ª—É—á–∏—Ç—å –º–æ–∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</button>
                <div id="result-my-travels" class="result"></div>
            </div>
        </div>

        <div id="feed" class="tab-content">
            <div class="test-section">
                <h2>–õ–µ–Ω—Ç–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π</h2>
                <div class="form-group">
                    <label for="feed-country">–°—Ç—Ä–∞–Ω–∞ (—Ñ–∏–ª—å—Ç—Ä):</label>
                    <input type="text" id="feed-country" placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω">
                </div>
                <div class="form-group">
                    <label for="feed-limit">–õ–∏–º–∏—Ç:</label>
                    <input type="number" id="feed-limit" value="10" min="1" max="50">
                </div>
                <button onclick="getFeed()">–ü–æ–ª—É—á–∏—Ç—å –ª–µ–Ω—Ç—É</button>
                <div id="result-feed" class="result"></div>
            </div>

            <div class="test-section">
                <h2>–°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω</h2>
                <button onclick="getCountries()">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω</button>
                <div id="result-countries" class="result"></div>
            </div>
        </div>

        <footer>
            <p>Travel Online API ‚Ä¢ –í–µ—Ä—Å–∏—è 1.0 ‚Ä¢ <span id="api-status">–°—Ç–∞—Ç—É—Å: –ø—Ä–æ–≤–µ—Ä–∫–∞...</span></p>
            <p>–¢–æ–∫–µ–Ω: <span id="token-status">–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span></p>
        </footer>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        let token = localStorage.getItem('travel_token') || '';
        let currentUserId = localStorage.getItem('travel_user_id') || '';

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleString();
        }
        setInterval(updateTime, 1000);
        updateTime();

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–∞–º–∏
        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // –û–±—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞
        async function makeRequest(url, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            if (token) {
                options.headers['Authorization'] = `Bearer ${token}`;
            }

            if (data) {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(`${API_URL}${url}`, options);
                const result = await response.json();

                return {
                    success: response.ok,
                    status: response.status,
                    data: result,
                    headers: response.headers
                };
            } catch (error) {
                return {
                    success: false,
                    status: 0,
                    data: { error: error.message }
                };
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function displayResult(elementId, result, title = '') {
            const element = document.getElementById(elementId);
            const statusClass = result.success ? 'success' : 'error';

            let html = '';
            if (title) {
                html += `<h4>${title}</h4>`;
            }

            html += `<div class="response-info">
                <span class="${statusClass}">–°—Ç–∞—Ç—É—Å: ${result.status}</span>
                <span>${result.success ? '‚úÖ –£—Å–ø–µ—à–Ω–æ' : '‚ùå –û—à–∏–±–∫–∞'}</span>
            </div>`;

            html += `<pre>${JSON.stringify(result.data, null, 2)}</pre>`;
            element.innerHTML = html;
        }

        // –¢–µ—Å—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
        async function testEndpoint(endpoint, method = 'GET') {
            const result = await makeRequest(endpoint, method);
            displayResult(`result-${endpoint.split('/').pop()}`, result, `${method} ${endpoint}`);
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function register() {
            const data = {
                login: document.getElementById('reg-login').value || `user_${Date.now()}`,
                email: document.getElementById('reg-email').value || `test_${Date.now()}@example.com`,
                password: document.getElementById('reg-password').value || 'password123',
                name: document.getElementById('reg-name').value || '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                country: document.getElementById('reg-country').value || '–†–æ—Å—Å–∏—è'
            };

            const result = await makeRequest('/auth/register', 'POST', data);
            displayResult('result-register', result, '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è');

            if (result.success && result.data.token) {
                token = result.data.token;
                currentUserId = result.data.user.id;
                localStorage.setItem('travel_token', token);
                localStorage.setItem('travel_user_id', currentUserId);
                updateTokenStatus();
                alert('‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω.');
            }
        }

        // –í—Ö–æ–¥
        async function login() {
            const data = {
                login: document.getElementById('login-login').value || 'test_user',
                password: document.getElementById('login-password').value || 'password123'
            };

            const result = await makeRequest('/auth/login', 'POST', data);
            displayResult('result-login', result, '–í—Ö–æ–¥');

            if (result.success && result.data.token) {
                token = result.data.token;
                currentUserId = result.data.user.id;
                localStorage.setItem('travel_token', token);
                localStorage.setItem('travel_user_id', currentUserId);
                updateTokenStatus();
                alert('‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω! –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—ë–Ω.');
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
        async function createTravel() {
            if (!token) {
                alert('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å!');
                showTab('auth');
                return;
            }

            const data = {
                title: document.getElementById('travel-title').value || `–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ ${new Date().toLocaleDateString()}`,
                description: document.getElementById('travel-description').value || '–û–ø–∏—Å–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è',
                country: document.getElementById('travel-country').value || '–†–æ—Å—Å–∏—è',
                type: document.getElementById('travel-type').value,
                is_public: true,
                start_date: '2024-06-01',
                end_date: '2024-06-10',
                budget: 50000
            };

            const result = await makeRequest('/travels', 'POST', data);
            displayResult('result-travel-create', result, '–°–æ–∑–¥–∞–Ω–∏–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è');
        }

        // –ú–æ–∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è
        async function getMyTravels() {
            if (!token) {
                alert('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å!');
                showTab('auth');
                return;
            }

            const result = await makeRequest('/travels/my', 'GET');
            displayResult('result-my-travels', result, '–ú–æ–∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è');
        }

        // –õ–µ–Ω—Ç–∞
        async function getFeed() {
            const country = document.getElementById('feed-country').value;
            const limit = document.getElementById('feed-limit').value;
            let url = '/feed';

            const params = new URLSearchParams();
            if (country) params.append('country', country);
            if (limit) params.append('limit', limit);

            if (params.toString()) {
                url += `?${params.toString()}`;
            }

            const result = await makeRequest(url, 'GET');
            displayResult('result-feed', result, '–õ–µ–Ω—Ç–∞ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π');
        }

        // –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω
        async function getCountries() {
            const result = await makeRequest('/feed/countries', 'GET');
            displayResult('result-countries', result, '–°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–∫–µ–Ω–∞
        function updateTokenStatus() {
            document.getElementById('token-status').textContent =
                token ? '—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω' : '–Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
            document.getElementById('token-status').style.color =
                token ? '#4CAF50' : '#f44336';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                document.getElementById('api-status').innerHTML =
                    `<span class="success">‚úÖ ${data.message}</span>`;
            } catch (error) {
                document.getElementById('api-status').innerHTML =
                    `<span class="error">‚ùå API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>`;
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function () {
            updateTokenStatus();
            checkApiStatus();
            testEndpoint('/health', 'GET');
        };
    </script>
</body>

</html>